#NoEnv
#SingleInstance Force

; Function to call DLL exports
CallDllFunction(functionName) {
    hModule := DllCall("LoadLibrary", "Str", "test_dll.dll")
    
    if (!hModule) {
        MsgBox("Failed to load DLL")
        return false
    }
    
    funcAddr := DllCall("GetProcAddress", "Ptr", hModule, "AStr", functionName)
    
    if (!funcAddr) {
        MsgBox("Function " functionName " not found")
        DllCall("FreeLibrary", "Ptr", hModule)
        return false
    }
    
    ; Call the function
    result := DllCall(funcAddr)
    
    ; Clean up
    DllCall("FreeLibrary", "Ptr", hModule)
    return true
}

; Test GUI
MyGui := Gui()
MyGui.Add("Button", "w200", "Test Calculator").OnEvent("Click", TestCalc)
MyGui.Add("Button", "w200", "Test Command Prompt").OnEvent("Click", TestCMD)
MyGui.Add("Button", "w200", "Test Message Box").OnEvent("Click", TestMsg)
MyGui.Add("Button", "w200", "Test All Functions").OnEvent("Click", TestAll)
MyGui.Add("Button", "w200", "Exit").OnEvent("Click", ExitApp)

MyGui.Title := "DLL Tester"
MyGui.Show("w220 h200")
return

TestCalc(*) {
    CallDllFunction("OpenCalculator")
}

TestCMD(*) {
    CallDllFunction("OpenCommandPrompt")
}

TestMsg(*) {
    CallDllFunction("ShowMessageBox")
}

TestAll(*) {
    CallDllFunction("RunAllTests")
}

ExitApp(*) {
    ExitApp
}

GuiClose(*) {
    ExitApp
}
